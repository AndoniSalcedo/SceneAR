<html>
	<head>
		<meta charset="UTF-8" />
		<title>Escena AR</title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.1/dist/mindar-image-aframe.prod.js"></script>

		<script>
			AFRAME.registerComponent("occlusion", {
				schema: {
					type: "boolean",
					default: true,
				},

				init: function () {
					this.setOcclusion(this.data);
				},

				update: function () {
					console.log(this.data);
					this.setOcclusion(this.data);
				},

				setOcclusion: function (val) {
					const material = new THREE.MeshStandardMaterial({
						colorWrite: !val,
						color: 0xff0000,
					});

					this.el.object3D.traverse((obj) => {
						obj.material = material;
					});
				},
			});

			AFRAME.registerComponent("shadowonly", {
				init: function () {
					// Create shadow material
					const material = new THREE.ShadowMaterial({
						opacity: 0.2,
					});

					// Apply material to object and all children
					this.el.object3D.traverse((obj) => {
						obj.material = material;
					});
				},
			});
		</script>
	</head>
	<body>
		<a-scene
			mindar-image="imageTargetSrc: ./skell.mind;"
			vr-mode-ui="enabled: false"
			device-orientation-permission-ui="enabled: false"
		>
			<a-assets>
				<a-asset-item
					src="./assets/plant/potted_plant_04_1k.gltf"
					id="plant"
				/>
				<a-asset-item
					src="./assets/ceramic/ceramic_vase_02_1k.gltf"
					id="ceramic"
				/>
			</a-assets>
			<a-camera
				position="0 0 0"
				look-controls="enabled: false"
			></a-camera>

			<a-entity mindar-image-target="targetIndex: 0">
				<a-box
					position="2.2 -1.5 -0.5"
					rotation="5 0 0"
					scale="1.1 0.7 0.1"
					material="color:orange;opacity:0.5"
					geometry
					occlusion
				></a-box>

				<a-entity
					id="ceramic_"
					gltf-model="#ceramic"
					position="2.2 -2 -1.5"
					rotation="5 0 0"
					scale="1.5 4 2"
					shadow
				></a-entity>

				<a-entity
					id="plant_"
					gltf-model="#plant"
					position="0 -1.5 0"
					rotation="5 0 0"
					scale="2 2 2"
					shadow
				></a-entity>

				<a-plane
					material="color:white;opacity:0.5"
					scale="10 10 10"
					position="0 -1.6 0"
					rotation="-90 0 0"
					shadow="cast:false"
					shadowonly
				></a-plane>

				<a-entity
					id="luz_blanca"
					position="5 1 5"
					light="type:spot; castShadow:true; intensity:0.9;color:white"
				>
				</a-entity>

				<a-entity id="luz_ambiente" light="type:ambient; intensity:0.2">
				</a-entity>
			</a-entity>
		</a-scene>
	</body>
</html>
